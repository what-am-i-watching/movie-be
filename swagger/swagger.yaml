---
openapi: 3.0.1
info:
  title: What Am I Watching? API
  version: 1.0.0
  description: API for managing movies and TV shows watchlists
  contact:
    email: whatamiwatching.info@gmail.com
paths:
  "/users/password":
    post:
      summary: Request password reset
      tags:
      - Authentication
      description: Request password reset instructions. Sends an email with reset
        link to the user.
      security: []
      parameters: []
      responses:
        '200':
          description: Password reset instructions sent
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Password reset instructions sent to your email
                required:
                - message
        '422':
          description: Validation errors
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: array
                    items:
                      type: string
                    example:
                    - Email not found
                required:
                - errors
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                user:
                  type: object
                  properties:
                    email:
                      type: string
                      format: email
                      example: user@example.com
                      description: User email address
                  required:
                  - email
              required:
              - user
        required: true
    patch:
      summary: Reset password with token
      tags:
      - Authentication
      description: Reset password using the token from the reset email. Token is included
        in the reset link sent via email.
      security: []
      parameters: []
      responses:
        '200':
          description: Password successfully reset
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Password successfully reset
                required:
                - message
        '422':
          description: Validation errors
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: array
                    items:
                      type: string
                    example:
                    - Reset password token is invalid
                    - Password is too short (minimum is 6 characters)
                    - Password confirmation doesn't match Password
                required:
                - errors
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                user:
                  type: object
                  properties:
                    reset_password_token:
                      type: string
                      example: abc123def456
                      description: Token from password reset email link
                    password:
                      type: string
                      format: password
                      example: newpassword123
                      description: New password
                      minLength: 6
                    password_confirmation:
                      type: string
                      format: password
                      example: newpassword123
                      description: Password confirmation (must match password)
                      minLength: 6
                  required:
                  - reset_password_token
                  - password
                  - password_confirmation
              required:
              - user
        required: true
  "/users":
    post:
      summary: Create a new user account
      tags:
      - Authentication
      description: Register a new user account. Returns user data and JWT token in
        Authorization header.
      security: []
      parameters: []
      responses:
        '200':
          description: User created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: integer
                    example: 200
                  message:
                    type: string
                    example: Signed up successfully
                  data:
                    type: object
                    properties:
                      id:
                        type: integer
                      email:
                        type: string
                        format: email
                      created_at:
                        type: string
                        format: date_time
                      updated_at:
                        type: string
                        format: date_time
                      jti:
                        type: string
                required:
                - status
                - message
                - data
        '422':
          description: Validation errors
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: integer
                    example: 400
                  message:
                    type: string
                    example: User could not be created.
                  errors:
                    type: array
                    items:
                      type: string
                    example:
                    - Email has already been taken
                    - Password is too short (minimum is 6 characters)
                required:
                - status
                - message
                - errors
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                user:
                  type: object
                  properties:
                    email:
                      type: string
                      format: email
                      example: user@example.com
                      description: User email address
                    password:
                      type: string
                      format: password
                      example: password123
                      description: User password (minimum length may apply)
                      minLength: 6
                  required:
                  - email
                  - password
              required:
              - user
        required: true
  "/users/sign_in":
    post:
      summary: Sign in
      tags:
      - Authentication
      description: Authenticate user with email and password. Returns user data and
        JWT in Authorization header.
      security: []
      parameters: []
      responses:
        '200':
          description: User signed in successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: integer
                    example: 200
                  message:
                    type: string
                    example: User signed in successfully
                  data:
                    type: object
                    properties:
                      id:
                        type: integer
                      email:
                        type: string
                        format: email
                      created_at:
                        type: string
                        format: date_time
                      updated_at:
                        type: string
                        format: date_time
                      jti:
                        type: string
                required:
                - status
                - message
                - data
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Invalid Email or password.
                    description: Error message (e.g. invalid credentials or unauthenticated)
                  message:
                    type: string
                    description: Additional i18n message when present
                required:
                - error
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                user:
                  type: object
                  properties:
                    email:
                      type: string
                      format: email
                      example: user@example.com
                      description: User email address
                    password:
                      type: string
                      format: password
                      example: password123
                      description: User password
                  required:
                  - email
                  - password
              required:
              - user
        required: true
  "/me":
    get:
      summary: Get current user
      tags:
      - Authentication
      description: Get the currently authenticated user information. Requires valid
        JWT token in Authorization header.
      security:
      - bearerAuth: []
      responses:
        '200':
          description: User information retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      id:
                        type: string
                        example: '1'
                      type:
                        type: string
                        example: user
                      attributes:
                        type: object
                        properties:
                          email:
                            type: string
                            format: email
                            example: user@example.com
                          created_at:
                            type: string
                            format: date_time
                required:
                - data
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: You need to sign in or sign up before continuing.
                    description: Error message when authentication fails
                required:
                - error
  "/users/sign_out":
    delete:
      summary: Sign out
      tags:
      - Authentication
      description: Sign out the current user. Invalidates the JWT token. Works even
        if token is expired.
      security:
      - bearerAuth: []
      responses:
        '200':
          description: Signed out successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: integer
                    example: 200
                  message:
                    type: string
                    example: Signed out successfully
                required:
                - status
                - message
        '401':
          description: No token provided
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: integer
                    example: 401
                  message:
                    type: string
                    example: No token provided
                required:
                - status
                - message
servers:
- url: http://localhost:3000
  description: Development server
- url: https://whatamiwatching.info
  description: Production server
tags:
- name: Authentication
  description: User authentication endpoints
- name: Movies
  description: Movie and TV show endpoints
- name: User Movies
  description: User movie list management
- name: Health
  description: Health check endpoints
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: 'JWT token obtained from POST /users/sign_in endpoint. Include
        the token in the Authorization header as: Bearer {token}'
  schemas: {}
