---
openapi: 3.0.1
info:
  title: What Am I Watching? API
  version: 1.0.0
  description: API for managing movies and TV shows watchlists
  contact:
    email: whatamiwatching.info@gmail.com
paths:
  "/movies/popular":
    get:
      summary: Get popular movies
      tags:
      - Movies
      description: Get a list of currently popular movies from TMDB. Results are enriched
        with user-specific data (in_list, status, rating, etc.).
      security:
      - bearerAuth: []
      responses:
        '200':
          description: Popular movies list
          content:
            application/json:
              schema:
                type: object
                properties:
                  movies:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                          nullable: true
                          description: Database ID (nil if not in database)
                          example: 1
                        tmdb_id:
                          type: integer
                          description: TMDB (The Movie Database) ID
                          example: 603
                        title:
                          type: string
                          description: Movie title
                          example: The Matrix
                        release_date:
                          type: string
                          format: date
                          nullable: true
                          description: Release date
                          example: '1999-03-31'
                        poster_path:
                          type: string
                          nullable: true
                          description: Poster image path/URL
                          example: "/f89U3ADr1oiB1s9GkdPOEpXUk5H.jpg"
                        is_movie:
                          type: boolean
                          description: True if movie, false if TV show
                          example: true
                        in_list:
                          type: boolean
                          description: Whether this movie is in the user's list
                          example: false
                        user_movie_id:
                          type: integer
                          nullable: true
                          description: User movie association ID (if in_list is true)
                          example: 5
                        status:
                          type: string
                          nullable: true
                          enum:
                          - to_watch
                          - watching
                          - watched
                          description: Watch status (only present if in_list is true)
                          example: to_watch
                        rating:
                          type: integer
                          nullable: true
                          description: User rating (only present if in_list is true)
                          example: 5
                        notes:
                          type: string
                          nullable: true
                          description: User notes (only present if in_list is true)
                          example: Great movie!
                        progress_notes:
                          type: string
                          nullable: true
                          description: Progress notes for TV shows (only present if
                            in_list is true)
                          example: On season 2, episode 4
                        overview:
                          type: string
                          nullable: true
                          description: Plot overview/synopsis
                          example: A computer hacker learns about the true nature
                            of reality...
                        popularity:
                          type: number
                          description: Popularity score from TMDB
                          example: 85.5
                        adult:
                          type: boolean
                          description: Whether the content is marked as adult
                          example: false
                        backdrop_path:
                          type: string
                          nullable: true
                          description: Backdrop image path/URL
                          example: "/r8FD6CC3GgjWaGVkZh00AcedfpA.jpg"
                        genre_ids:
                          type: array
                          items:
                            type: integer
                          description: Array of genre IDs from TMDB
                          example:
                          - 18
                          - 878
                          - 9648
                        original_language:
                          type: string
                          nullable: true
                          description: Original language code (e.g., "en", "es")
                          example: en
                        original_title:
                          type: string
                          nullable: true
                          description: Original title (may differ from localized title)
                          example: Arrival
                        video:
                          type: boolean
                          description: Whether the content has video (typically false
                            for movies)
                          example: false
                        vote_average:
                          type: number
                          description: Average vote rating from TMDB
                          example: 7.623
                        vote_count:
                          type: integer
                          description: Number of votes on TMDB
                          example: 18910
                required:
                - movies
                example:
                  movies:
                  - id:
                    tmdb_id: 550
                    title: Fight Club
                    release_date: '1999-10-15'
                    poster_path: "/pB8BM7pdSp6B6Ih7QZ4DrQ3PmJK.jpg"
                    is_movie: true
                    in_list: false
                    user_movie_id:
                    overview: A ticking-time-bomb insomniac and a slippery soap salesman
                      channel primal male aggression into a shocking new form of therapy.
                    popularity: 67.2
                    adult: false
                    backdrop_path: "/87hTDiay2N2qWyX4am7nykG2w7n.jpg"
                    genre_ids:
                    - 18
                    original_language: en
                    original_title: Fight Club
                    video: false
                    vote_average: 8.4
                    vote_count: 28000
                  - id: 12
                    tmdb_id: 278
                    title: The Shawshank Redemption
                    release_date: '1994-09-23'
                    poster_path: "/9cqN61F9bG7cxOBcALofZTkN6nL.jpg"
                    is_movie: true
                    in_list: true
                    user_movie_id: 15
                    status: watched
                    rating: 5
                    notes: One of my favorites!
                    progress_notes:
                    overview: Framed in the 1940s for the double murder of his wife
                      and her lover, upstanding banker Andy Dufresne begins a new
                      life at the Shawshank prison.
                    popularity: 92.5
                    adult: false
                    backdrop_path: "/iNh3BivHyg5sQRPP1KOkzguEX0H.jpg"
                    genre_ids:
                    - 18
                    - 80
                    original_language: en
                    original_title: The Shawshank Redemption
                    video: false
                    vote_average: 9.3
                    vote_count: 28000
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: You need to sign in or sign up before continuing.
                required:
                - error
  "/movies/search":
    get:
      summary: Search movies and TV shows
      tags:
      - Movies
      description: Search for movies and TV shows by query string. Returns combined
        results sorted by popularity.
      security:
      - bearerAuth: []
      parameters:
      - name: query
        in: query
        required: true
        description: Search query string
        example: The Matrix
        schema:
          type: string
      responses:
        '200':
          description: Empty results when query is missing
          content:
            application/json:
              schema:
                type: object
                properties:
                  movies:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                          nullable: true
                          description: Database ID (nil if not in database)
                          example: 1
                        tmdb_id:
                          type: integer
                          description: TMDB (The Movie Database) ID
                          example: 603
                        title:
                          type: string
                          description: Movie or TV show title
                          example: The Matrix
                        release_date:
                          type: string
                          format: date
                          nullable: true
                          description: Release date (movies) or first air date (TV
                            shows)
                          example: '1999-03-31'
                        poster_path:
                          type: string
                          nullable: true
                          description: Poster image path/URL
                          example: "/f89U3ADr1oiB1s9GkdPOEpXUk5H.jpg"
                        is_movie:
                          type: boolean
                          description: True if movie, false if TV show
                          example: true
                        in_list:
                          type: boolean
                          description: Whether this movie/show is in the user's list
                          example: false
                        user_movie_id:
                          type: integer
                          nullable: true
                          description: User movie association ID (if in_list is true)
                          example: 5
                        status:
                          type: string
                          nullable: true
                          enum:
                          - to_watch
                          - watching
                          - watched
                          description: Watch status (only present if in_list is true)
                          example: to_watch
                        rating:
                          type: integer
                          nullable: true
                          description: User rating (only present if in_list is true)
                          example: 5
                        notes:
                          type: string
                          nullable: true
                          description: User notes (only present if in_list is true)
                          example: Great movie!
                        progress_notes:
                          type: string
                          nullable: true
                          description: Progress notes for TV shows (only present if
                            in_list is true)
                          example: On season 2, episode 4
                        overview:
                          type: string
                          nullable: true
                          description: Plot overview/synopsis
                          example: A computer hacker learns about the true nature
                            of reality...
                        popularity:
                          type: number
                          description: Popularity score from TMDB
                          example: 85.5
                        adult:
                          type: boolean
                          description: Whether the content is marked as adult
                          example: false
                        backdrop_path:
                          type: string
                          nullable: true
                          description: Backdrop image path/URL
                          example: "/r8FD6CC3GgjWaGVkZh00AcedfpA.jpg"
                        genre_ids:
                          type: array
                          items:
                            type: integer
                          description: Array of genre IDs from TMDB
                          example:
                          - 18
                          - 878
                          - 9648
                        original_language:
                          type: string
                          nullable: true
                          description: Original language code (e.g., "en", "es")
                          example: en
                        original_title:
                          type: string
                          nullable: true
                          description: Original title (may differ from localized title)
                          example: Arrival
                        video:
                          type: boolean
                          description: Whether the content has video (typically false
                            for movies)
                          example: false
                        vote_average:
                          type: number
                          description: Average vote rating from TMDB
                          example: 7.623
                        vote_count:
                          type: integer
                          description: Number of votes on TMDB
                          example: 18910
                    example: []
                required:
                - movies
                example:
                  movies:
                  - id: 38
                    tmdb_id: 329865
                    title: Arrival
                    release_date: '2016-11-10'
                    poster_path: "/iQBIXJprC8AN7Jwx7aOI0gPUqff.jpg"
                    is_movie: true
                    in_list: true
                    user_movie_id: 36
                    status: watched
                    rating: 4
                    notes:
                    progress_notes:
                    overview: Taking place after alien crafts land around the world,
                      an expert linguist is recruited by the military to determine
                      whether they come in peace or are a threat.
                    popularity: 11.666
                    adult: false
                    backdrop_path: "/r8FD6CC3GgjWaGVkZh00AcedfpA.jpg"
                    genre_ids:
                    - 18
                    - 878
                    - 9648
                    original_language: en
                    original_title: Arrival
                    video: false
                    vote_average: 7.623
                    vote_count: 18910
                  - id:
                    tmdb_id: 603
                    title: The Matrix
                    release_date: '1999-03-31'
                    poster_path: "/f89U3ADr1oiB1s9GkdPOEpXUk5H.jpg"
                    is_movie: true
                    in_list: false
                    user_movie_id:
                    overview: A computer hacker learns from mysterious rebels about
                      the true nature of his reality and his role in the war against
                      its controllers.
                    popularity: 85.5
                    adult: false
                    backdrop_path: "/fNG7i7RqMErkcqhohV2a6cV1Ehy.jpg"
                    genre_ids:
                    - 28
                    - 878
                    original_language: en
                    original_title: The Matrix
                    video: false
                    vote_average: 8.7
                    vote_count: 25000
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: You need to sign in or sign up before continuing.
                required:
                - error
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Failed to fetch movies
                  details:
                    type: string
                    description: Error details
                    example: Connection timeout
                required:
                - error
  "/users/password":
    post:
      summary: Request password reset
      tags:
      - Authentication
      description: Request password reset instructions. Sends an email with reset
        link to the user.
      security: []
      parameters: []
      responses:
        '200':
          description: Password reset instructions sent
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Password reset instructions sent to your email
                required:
                - message
        '422':
          description: Validation errors
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: array
                    items:
                      type: string
                    example:
                    - Email not found
                required:
                - errors
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                user:
                  type: object
                  properties:
                    email:
                      type: string
                      format: email
                      example: user@example.com
                      description: User email address
                  required:
                  - email
              required:
              - user
        required: true
    patch:
      summary: Reset password with token
      tags:
      - Authentication
      description: Reset password using the token from the reset email. Token is included
        in the reset link sent via email.
      security: []
      parameters: []
      responses:
        '200':
          description: Password successfully reset
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Password successfully reset
                required:
                - message
        '422':
          description: Validation errors
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: array
                    items:
                      type: string
                    example:
                    - Reset password token is invalid
                    - Password is too short (minimum is 6 characters)
                    - Password confirmation doesn't match Password
                required:
                - errors
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                user:
                  type: object
                  properties:
                    reset_password_token:
                      type: string
                      example: abc123def456
                      description: Token from password reset email link
                    password:
                      type: string
                      format: password
                      example: newpassword123
                      description: New password
                      minLength: 6
                    password_confirmation:
                      type: string
                      format: password
                      example: newpassword123
                      description: Password confirmation (must match password)
                      minLength: 6
                  required:
                  - reset_password_token
                  - password
                  - password_confirmation
              required:
              - user
        required: true
  "/users":
    post:
      summary: Create a new user account
      tags:
      - Authentication
      description: Register a new user account. Returns user data and JWT token in
        Authorization header.
      security: []
      parameters: []
      responses:
        '200':
          description: User created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: integer
                    example: 200
                  message:
                    type: string
                    example: Signed up successfully
                  data:
                    type: object
                    properties:
                      id:
                        type: integer
                      email:
                        type: string
                        format: email
                      created_at:
                        type: string
                        format: date_time
                      updated_at:
                        type: string
                        format: date_time
                      jti:
                        type: string
                required:
                - status
                - message
                - data
        '422':
          description: Validation errors
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: integer
                    example: 400
                  message:
                    type: string
                    example: User could not be created.
                  errors:
                    type: array
                    items:
                      type: string
                    example:
                    - Email has already been taken
                    - Password is too short (minimum is 6 characters)
                required:
                - status
                - message
                - errors
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                user:
                  type: object
                  properties:
                    email:
                      type: string
                      format: email
                      example: user@example.com
                      description: User email address
                    password:
                      type: string
                      format: password
                      example: password123
                      description: User password (minimum length may apply)
                      minLength: 6
                  required:
                  - email
                  - password
              required:
              - user
        required: true
  "/users/sign_in":
    post:
      summary: Sign in
      tags:
      - Authentication
      description: Authenticate user with email and password. Returns user data and
        JWT in Authorization header.
      security: []
      parameters: []
      responses:
        '200':
          description: User signed in successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: integer
                    example: 200
                  message:
                    type: string
                    example: User signed in successfully
                  data:
                    type: object
                    properties:
                      id:
                        type: integer
                      email:
                        type: string
                        format: email
                      created_at:
                        type: string
                        format: date_time
                      updated_at:
                        type: string
                        format: date_time
                      jti:
                        type: string
                required:
                - status
                - message
                - data
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Invalid Email or password.
                    description: Error message (e.g. invalid credentials or unauthenticated)
                  message:
                    type: string
                    description: Additional i18n message when present
                required:
                - error
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                user:
                  type: object
                  properties:
                    email:
                      type: string
                      format: email
                      example: user@example.com
                      description: User email address
                    password:
                      type: string
                      format: password
                      example: password123
                      description: User password
                  required:
                  - email
                  - password
              required:
              - user
        required: true
  "/me":
    get:
      summary: Get current user
      tags:
      - Authentication
      description: Get the currently authenticated user information. Requires valid
        JWT token in Authorization header.
      security:
      - bearerAuth: []
      responses:
        '200':
          description: User information retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      id:
                        type: string
                        example: '1'
                      type:
                        type: string
                        example: user
                      attributes:
                        type: object
                        properties:
                          email:
                            type: string
                            format: email
                            example: user@example.com
                          created_at:
                            type: string
                            format: date_time
                required:
                - data
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: You need to sign in or sign up before continuing.
                    description: Error message when authentication fails
                required:
                - error
  "/users/sign_out":
    delete:
      summary: Sign out
      tags:
      - Authentication
      description: Sign out the current user. Invalidates the JWT token. Works even
        if token is expired.
      security:
      - bearerAuth: []
      responses:
        '200':
          description: Signed out successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: integer
                    example: 200
                  message:
                    type: string
                    example: Signed out successfully
                required:
                - status
                - message
        '401':
          description: No token provided
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: integer
                    example: 401
                  message:
                    type: string
                    example: No token provided
                required:
                - status
                - message
servers:
- url: http://localhost:3000
  description: Development server
- url: https://whatamiwatching.info
  description: Production server
tags:
- name: Authentication
  description: User authentication endpoints
- name: Movies
  description: Movie and TV show endpoints
- name: User Movies
  description: User movie list management
- name: Health
  description: Health check endpoints
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: 'JWT token obtained from POST /users/sign_in endpoint. Include
        the token in the Authorization header as: Bearer {token}'
  schemas: {}
